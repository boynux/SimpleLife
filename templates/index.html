<html>
    <head>
    </head>
    <body>
        <fb:login-button autologoutlink="true" scope="publish_stream,user_photos"></fb:login-button>

        {% if current_user %}
        <p>
            <a href="{{ current_user.profile_url }}">
                <img src="http://graph.facebook.com/{{ current_user }}/picture?type=square"/>
            </a> <span id='name'></span>
        </p>
          <p>Hello, {{ current_user.name|escape }}</p>
        {% endif %}

        <div id="fb-root"></div>

        {% if current_user %}
        <div>
            Upload photo test: 
            <form method="post">
                Enter URL to URLFetch from:<input type="text" name="url"/>
                <input type="submit"/>
            </form>
        </div>
        {% endif %}

        <script language='javascript' type='text/javascript'>
            window.fbAsyncInit = function() {
                FB.init({
                    appId: '{{ facebook_app_id }}', 
                    status: true, 
                    cookie: true,
                    xfbml: true,
                });

                FB.Event.subscribe('{% if current_user %}auth.logout{% else %}auth.login{% endif %}', function(response) {
                    {% if current_user %} window.location = "/signin" {% else %} window.location.reload(); {% endif %}
                });

                FB.api ('/{{ current_user }}', function (response) {
                        document.getElementById ('name').innerHTML = response.name
                });
            };

            (function() {
                 var e = document.createElement('script');
                 e.type = 'text/javascript';
                 e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
                 e.async = true;
                 document.getElementById('fb-root').appendChild(e);
             }());
         </script>
    </body>
</html>
